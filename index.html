<script>
  // Format angka pakai titik ribuan (Indonesia)
  function formatNumber(num) {
    return Number(num).toLocaleString('id-ID');
  }

  // Format persen
  function formatPercent(num) {
    return num.toFixed(2) + "%";
  }

  fetch('performance_sales.csv')
    .then(response => response.text())
    .then(data => {
      let rows = data.trim().split('\n').map(r => r.split(','));
      let table = document.getElementById('dataTable');

      // Header dari CSV
      let header = rows[0];

      // Tambahkan kolom baru
      header.push("Order %", "Sales %", "Gap Order", "Gap Sales");

      // Draw Header
      let thead = document.createElement('tr');
      header.forEach(h => {
        let th = document.createElement('th');
        th.textContent = h;
        thead.appendChild(th);
      });
      table.appendChild(thead);

      // Draw Data
      for (let i = 1; i < rows.length; i++) {
        let row = rows[i];
        let tr = document.createElement('tr');

        let name = row[0];
        let code = row[1];
        let custname = row[2];
        let target = Number(row[3]);
        let order = Number(row[4]);
        let sales = Number(row[5]);

        // Hitung nilai
        let orderPercent = (order / target) * 100;
        let salesPercent = (sales / target) * 100;
        let gapOrder = target - order;
        let gapSales = target - sales;

        // Data final tampil
        let rowData = [
          name,
          code,
          custname,
          formatNumber(target),
          formatNumber(order),
          formatPercent(orderPercent),
          formatNumber(sales),
          formatPercent(salesPercent),
          formatNumber(gapOrder),
          formatNumber(gapSales)
        ];

        rowData.forEach(val => {
          let td = document.createElement('td');
          td.textContent = val;
          tr.appendChild(td);
        });

        table.appendChild(tr);
      }
    });
</script>
